{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/clean-blog/source/css/article.styl","path":"css/article.styl","modified":0,"renderable":1},{"_id":"themes/clean-blog/source/css/mixins.styl","path":"css/mixins.styl","modified":0,"renderable":1},{"_id":"themes/clean-blog/source/css/variables.styl","path":"css/variables.styl","modified":0,"renderable":1},{"_id":"themes/clean-blog/source/css/style.styl","path":"css/style.styl","modified":0,"renderable":1},{"_id":"themes/clean-blog/source/css/base.styl","path":"css/base.styl","modified":0,"renderable":1},{"_id":"themes/clean-blog/source/img/about-bg.jpg","path":"img/about-bg.jpg","modified":0,"renderable":1},{"_id":"themes/clean-blog/source/img/home-bg.jpg","path":"img/home-bg.jpg","modified":0,"renderable":1},{"_id":"themes/clean-blog/source/img/contact-bg.jpg","path":"img/contact-bg.jpg","modified":0,"renderable":1}],"Cache":[{"_id":"source/.DS_Store","hash":"c6d389e357a8ac65abb65157d66eddb0a27ddc73","modified":1486716431000},{"_id":"themes/clean-blog/LICENSE","hash":"8726b416df4f067cff579e859f05c4b594b8be09","modified":1486713054000},{"_id":"themes/clean-blog/_config.yml","hash":"c5724a28b3298af65d8dc3f1c92c003d8e3107e4","modified":1486721708000},{"_id":"themes/clean-blog/README.md","hash":"c5c7b0fd01aa229304e7b00697517aaca51de577","modified":1486713054000},{"_id":"themes/clean-blog/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1486713054000},{"_id":"themes/clean-blog/.git/config","hash":"0037ed70f19e4933b19020ad514d8e9e049174f1","modified":1486713054000},{"_id":"themes/clean-blog/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1486713045000},{"_id":"source/_posts/适合多层级调转-各种子模块引用返回保留上一次查询记录.md","hash":"ef114500f94269ee649bc477e64ab18645d30bac","modified":1486953868000},{"_id":"themes/clean-blog/.git/index","hash":"8f6c1dde19e1683fc8ffdf92ae561f6762f39176","modified":1486952621000},{"_id":"themes/clean-blog/.git/packed-refs","hash":"1dadbd4fdd53bbb7038fa2c7b3c71cd028c4ead4","modified":1486713054000},{"_id":"themes/clean-blog/layout/archive.ejs","hash":"ad0da72df13ce3566985bb390c2c9a9352cf4f07","modified":1486713054000},{"_id":"themes/clean-blog/layout/index.ejs","hash":"87995288ca6f95a04add641727aedd3f6afa55eb","modified":1486713054000},{"_id":"themes/clean-blog/layout/page.ejs","hash":"38382e9bbeb6b8d2eafbd53fff2984111f524c1a","modified":1486713054000},{"_id":"themes/clean-blog/layout/post.ejs","hash":"38382e9bbeb6b8d2eafbd53fff2984111f524c1a","modified":1486713054000},{"_id":"themes/clean-blog/layout/layout.ejs","hash":"da2f9018047924ddaf376aee5996c7ddc06cebc1","modified":1486713054000},{"_id":"themes/clean-blog/languages/de.yml","hash":"424a9c1e6ab69334d7873f6574da02ca960aa572","modified":1486713054000},{"_id":"themes/clean-blog/languages/default.yml","hash":"97326c9e6518d9f379778178b3b8f9a58434725d","modified":1486713054000},{"_id":"themes/clean-blog/languages/en.yml","hash":"97326c9e6518d9f379778178b3b8f9a58434725d","modified":1486713054000},{"_id":"themes/clean-blog/languages/fr.yml","hash":"e9e6f7cb362ebb7997f11027498a2748fe3bac95","modified":1486713054000},{"_id":"themes/clean-blog/languages/es.yml","hash":"cb4eeca0ed3768a77e0cd216300f2b2549628b1b","modified":1486713054000},{"_id":"themes/clean-blog/languages/pl.yml","hash":"de7eb5850ae65ba7638e907c805fea90617a988c","modified":1486713054000},{"_id":"themes/clean-blog/languages/no.yml","hash":"8ca475a3b4f8efe6603030f0013aae39668230e1","modified":1486713054000},{"_id":"themes/clean-blog/languages/pt.yml","hash":"1d0c3689eb32fe13f37f8f6f303af7624ebfbaf0","modified":1486713054000},{"_id":"themes/clean-blog/languages/ru.yml","hash":"42df7afeb7a35dc46d272b7f4fb880a9d9ebcaa5","modified":1486713054000},{"_id":"themes/clean-blog/languages/zh-TW.yml","hash":"9acac6cc4f8002c3fa53ff69fb8cf66c915bd016","modified":1486713054000},{"_id":"themes/clean-blog/languages/zh-CN.yml","hash":"7bfcb0b8e97d7e5edcfca8ab26d55d9da2573c1c","modified":1486713054000},{"_id":"themes/clean-blog/.git/hooks/applypatch-msg.sample","hash":"86b9655a9ebbde13ac8dd5795eb4d5b539edab0f","modified":1486713045000},{"_id":"themes/clean-blog/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1486713045000},{"_id":"themes/clean-blog/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1486713045000},{"_id":"themes/clean-blog/.git/hooks/pre-applypatch.sample","hash":"42fa41564917b44183a50c4d94bb03e1768ddad8","modified":1486713045000},{"_id":"themes/clean-blog/.git/hooks/pre-commit.sample","hash":"36aed8976dcc08b5076844f0ec645b18bc37758f","modified":1486713045000},{"_id":"themes/clean-blog/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1486713045000},{"_id":"themes/clean-blog/.git/hooks/prepare-commit-msg.sample","hash":"2b6275eda365cad50d167fe3a387c9bc9fedd54f","modified":1486713045000},{"_id":"themes/clean-blog/.git/hooks/pre-rebase.sample","hash":"5885a56ab4fca8075a05a562d005e922cde9853b","modified":1486713045000},{"_id":"themes/clean-blog/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1486713045000},{"_id":"themes/clean-blog/.git/hooks/update.sample","hash":"39355a075977d05708ef74e1b66d09a36e486df1","modified":1486713045000},{"_id":"themes/clean-blog/.git/logs/HEAD","hash":"1c514eb906ae36c0bcf335566a106e9776434d7a","modified":1486713054000},{"_id":"themes/clean-blog/layout/_partial/after-footer.ejs","hash":"80970a6cfbf9b1abe0c472636b321a9be08fdc43","modified":1486713054000},{"_id":"themes/clean-blog/layout/_partial/article-full.ejs","hash":"8d63ce240bbcc850b5d438d1f45ad9441ac1c9cc","modified":1486713054000},{"_id":"themes/clean-blog/layout/_partial/article-archive.ejs","hash":"3d8d98c6545b8332a6d6ed4f8b00327df03ea945","modified":1486713054000},{"_id":"themes/clean-blog/layout/_partial/article-categories.ejs","hash":"5a0bf5a20f670621d8013c9b9d7976b45c8aa80f","modified":1486713054000},{"_id":"themes/clean-blog/layout/_partial/article-index.ejs","hash":"e433df4e245e2d4c628052c6e59966563542d94d","modified":1486713054000},{"_id":"themes/clean-blog/layout/_partial/comments.ejs","hash":"3aed4dafe9de34d81477d385d94bd5d16aebfa7f","modified":1486954136000},{"_id":"themes/clean-blog/layout/_partial/article-tags.ejs","hash":"6136434be09056c1466149cecb3cc2e80d107999","modified":1486713054000},{"_id":"themes/clean-blog/layout/_partial/footer.ejs","hash":"d252fb1a41890e6481bb054f9cc4ceec3c0b0ed9","modified":1486713054000},{"_id":"themes/clean-blog/layout/_partial/gallery.ejs","hash":"21e4f28909f4a79ff7d9f10bdfef6a8cb11632bf","modified":1486713054000},{"_id":"themes/clean-blog/layout/_partial/google-analytics.ejs","hash":"4e6e8de9becea5a1636a4dcadcf7a10c06e2426e","modified":1486713054000},{"_id":"themes/clean-blog/layout/_partial/head.ejs","hash":"3a7eb32f2cc540746c9e11010a4513b832743d1e","modified":1486713054000},{"_id":"themes/clean-blog/layout/_partial/menu.ejs","hash":"ba299316400499e9ede154e9627cafb7ce411888","modified":1486713054000},{"_id":"themes/clean-blog/layout/_partial/pagination.ejs","hash":"557d6bb069a1d48af49ae912994653f44b32a570","modified":1486713054000},{"_id":"themes/clean-blog/source/css/article.styl","hash":"f5294d7a3d6127fcb287de3ff0c12aebb1766c7b","modified":1486713054000},{"_id":"themes/clean-blog/source/css/mixins.styl","hash":"892f55e8a71f2e23a52e48e217dad3303bbad913","modified":1486713054000},{"_id":"themes/clean-blog/source/css/variables.styl","hash":"cd82df5ca8dfbcfec12d833f01adfac00878e835","modified":1486713054000},{"_id":"themes/clean-blog/source/css/style.styl","hash":"c40dc495a41007d21c59f342ee42b2d31d7b5ff4","modified":1486713054000},{"_id":"themes/clean-blog/source/css/base.styl","hash":"f0a6fcf58fe515e1359acde0ed34081f580ec7a3","modified":1486713054000},{"_id":"themes/clean-blog/source/img/about-bg.jpg","hash":"d39126a6456f2bac0169d1779304725f179c9900","modified":1486713054000},{"_id":"themes/clean-blog/.git/refs/heads/master","hash":"cce37529c01e70f25e6266bf6fb91c4c88b2f9fb","modified":1486713054000},{"_id":"themes/clean-blog/.git/objects/pack/pack-150961354dcaf41617990f9a9d18fb969ec0b9fb.idx","hash":"32e5daf443ca079417d364b3ef3a4144baae432b","modified":1486713054000},{"_id":"themes/clean-blog/source/img/home-bg.jpg","hash":"990f6f9dd0ecb5348bfcc47305553d58c0d8f326","modified":1486713054000},{"_id":"themes/clean-blog/.git/logs/refs/heads/master","hash":"1c514eb906ae36c0bcf335566a106e9776434d7a","modified":1486713054000},{"_id":"themes/clean-blog/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1486713054000},{"_id":"themes/clean-blog/source/img/contact-bg.jpg","hash":"6af63305c923899017e727b5ca968a2703bc08cf","modified":1486713054000},{"_id":"themes/clean-blog/.git/logs/refs/remotes/origin/HEAD","hash":"1c514eb906ae36c0bcf335566a106e9776434d7a","modified":1486713054000},{"_id":"themes/clean-blog/.git/objects/pack/pack-150961354dcaf41617990f9a9d18fb969ec0b9fb.pack","hash":"4cc90aed47a7c34d707952de5396981e230bfff1","modified":1486713054000},{"_id":"public/archives/index.html","hash":"ee3c382746c3c933386f2b15828b7ae7bdc20df5","modified":1486954143156},{"_id":"public/archives/2017/index.html","hash":"9432439ce3ac0e13dc670ebe213de7c15ba2d164","modified":1486954143166},{"_id":"public/archives/2017/02/index.html","hash":"e39de79feaa961aa2c6ac77caa1a6430004a057b","modified":1486954143167},{"_id":"public/index.html","hash":"5005645d3d6f12f36427513d27c0a2539923cc4a","modified":1486954143167},{"_id":"public/tags/java/index.html","hash":"bab745d91dd41c2f60aee5b84a37d362eba38d0b","modified":1486954143168},{"_id":"public/2017/02/10/:year/:month/:day/:title//index.html","hash":"8e6f01c7b8450b514e155df36cf013df6c02943e","modified":1486954143168}],"Category":[],"Data":[],"Page":[],"Post":[{"title":"适合多层级调转,各种子模块引用返回保留上一次查询记录","date":"2017-02-10T08:25:34.000Z","layout":"frist","slug":":year/:month/:day/:title/","_content":"用于使用web系统中查询\n\n\n \n[源码下载com.pagecache.zip](http://ol5i7ltje.bkt.clouddn.com/data/git/packagecachecom.pagecache.zip)\n\n基于Spring APO 环绕通知实现\n\n1.添加配置文件\naction-servlet.xml 最后添加\n\n<import resource=\"spring-aop-settings.xml\"/>\nspring-aop-settings.xml  \n\n```\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\nxmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:aop=\"http://www.springframework.org/schema/aop\"\nxsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\n        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd\">\n<aop:aspectj-autoproxy proxy-target-class=\"true\" />\n</beans>\n```\n\n\n2.修改代码(CacheAspectAdvice.java)\n第28行 指定切入点控制层\n\n```\n   @Pointcut(\"execution(* com.*.web.*.*(..))\")\n    public void CacheAspectAdvice() {\n    }\n    ```\n\n3.加入注解\n在自定控制层入口,加入需要记忆和恢复的注解(@FieldCache)\n\n```\n @RequestMapping(value = \"/list.do\")\n public ModelAndView list(HttpServletRequest request,@FieldCache SearchEntity domain){\n            ModelAndView modelAndView=new ModelAndView();\n            modelAndView.setViewName(\"list\");\n            return  modelAndView;\n  }\n```\n\n查询数据模型中,默认只会处理 String,Integer 两种类型\n如果不需要记录属性上方加入 @FieldTransient\n\n```\n//这是个栗了\npublic class SearchEntity extends BaseInput {\n    @FieldTransient\n    private String searchName;\n    public String get/set...\n}\n```\n\n如果其他引用对象里面也要加入记录和恢复(@FieldCache)\n\n```\n//父类同样回记录,回迭代最终Object\npublic class SearchEntity extends BaseInput {\n    @FieldTransient\n    private String searchName;\n    @FieldCache\n    private Page page;\n    public String getSearchName...\n   public String getPage...\n}\n```\n\n说明 \n1.从菜单进入需要加参数,会执行清空已经记录查询条件(pagCatchClean) 如:http://xxx/xxx.do?pagCatchClean\n\n2.默认情况下 post 的请求记录,get 请求清空,如果post 情况下 也好恢复记录不记录 加参数(pageRecover) 如:http://xxx/xxx.do?pageRecover\n\n3.缓存默认使用的本地,如果需要系统是负载(非hash)模式,需要 实现SearchObjectCache.java接口,存放到共享存储中(redis,mongodb....),\nSearchObjectCacheManager.java 缓存管理类实现好后 修改 其SearchObjectCache引用即可\n\nObjectCache.java 第34行开始\n\n```\n\n   /**\n     * 清空缓存标记\n     * 在浏览器地址加入\n     * http://xxx/xxx.do?pagCatchClean\n     **/\n    public static String pagCatchClean = \"pageCacheClean\";\n    public static String pagRecover = \"pageRecover\";\n    Logger logger = Logger.getLogger(ObjectCache.class.getName());\n public void cacheManager(HttpServletRequest request, Object o) {\n        String sessionId = request.getSession().getId();\n        String uri = request.getRequestURI();\n        if (null == uri || uri.equals(\"\")) {\n            return;\n        }\n        if (uri.indexOf(\"?\") > 0) {\n            uri = uri.substring(0, uri.indexOf(\"?\"));\n        }\n        String cacheKey = uri.concat(sessionId);\n        boolean isClean = request.getParameter(pagCatchClean) == null ? false : true;\n        //空清空缓存\n        if (isClean) {\n            SearainbowCacheManager.del(cacheKey);\n            logger.info(\"清空缓存 key==> \" + cacheKey);\n            return;\n        }\n        //post 查询 存储查询条件\n         if(request.getMethod().toUpperCase().equals(\"POST\") &&  null == request.getParameter(pagRecover)){\n             cache(sessionId, uri, isClean, o);\n         }else {\n             //get 或是其他 还原查询条件\n             recover(sessionId, uri, o);\n         }\n    }\n```\n ","source":"_posts/适合多层级调转-各种子模块引用返回保留上一次查询记录.md","raw":"---\ntitle: '适合多层级调转,各种子模块引用返回保留上一次查询记录'\ndate: 2017-02-10 16:25:34\ntags: java\nlayout: frist\nslug: pagecache\npermalink: :year/:month/:day/:title/\n---\n用于使用web系统中查询\n\n\n \n[源码下载com.pagecache.zip](http://ol5i7ltje.bkt.clouddn.com/data/git/packagecachecom.pagecache.zip)\n\n基于Spring APO 环绕通知实现\n\n1.添加配置文件\naction-servlet.xml 最后添加\n\n<import resource=\"spring-aop-settings.xml\"/>\nspring-aop-settings.xml  \n\n```\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\nxmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:aop=\"http://www.springframework.org/schema/aop\"\nxsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\n        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd\">\n<aop:aspectj-autoproxy proxy-target-class=\"true\" />\n</beans>\n```\n\n\n2.修改代码(CacheAspectAdvice.java)\n第28行 指定切入点控制层\n\n```\n   @Pointcut(\"execution(* com.*.web.*.*(..))\")\n    public void CacheAspectAdvice() {\n    }\n    ```\n\n3.加入注解\n在自定控制层入口,加入需要记忆和恢复的注解(@FieldCache)\n\n```\n @RequestMapping(value = \"/list.do\")\n public ModelAndView list(HttpServletRequest request,@FieldCache SearchEntity domain){\n            ModelAndView modelAndView=new ModelAndView();\n            modelAndView.setViewName(\"list\");\n            return  modelAndView;\n  }\n```\n\n查询数据模型中,默认只会处理 String,Integer 两种类型\n如果不需要记录属性上方加入 @FieldTransient\n\n```\n//这是个栗了\npublic class SearchEntity extends BaseInput {\n    @FieldTransient\n    private String searchName;\n    public String get/set...\n}\n```\n\n如果其他引用对象里面也要加入记录和恢复(@FieldCache)\n\n```\n//父类同样回记录,回迭代最终Object\npublic class SearchEntity extends BaseInput {\n    @FieldTransient\n    private String searchName;\n    @FieldCache\n    private Page page;\n    public String getSearchName...\n   public String getPage...\n}\n```\n\n说明 \n1.从菜单进入需要加参数,会执行清空已经记录查询条件(pagCatchClean) 如:http://xxx/xxx.do?pagCatchClean\n\n2.默认情况下 post 的请求记录,get 请求清空,如果post 情况下 也好恢复记录不记录 加参数(pageRecover) 如:http://xxx/xxx.do?pageRecover\n\n3.缓存默认使用的本地,如果需要系统是负载(非hash)模式,需要 实现SearchObjectCache.java接口,存放到共享存储中(redis,mongodb....),\nSearchObjectCacheManager.java 缓存管理类实现好后 修改 其SearchObjectCache引用即可\n\nObjectCache.java 第34行开始\n\n```\n\n   /**\n     * 清空缓存标记\n     * 在浏览器地址加入\n     * http://xxx/xxx.do?pagCatchClean\n     **/\n    public static String pagCatchClean = \"pageCacheClean\";\n    public static String pagRecover = \"pageRecover\";\n    Logger logger = Logger.getLogger(ObjectCache.class.getName());\n public void cacheManager(HttpServletRequest request, Object o) {\n        String sessionId = request.getSession().getId();\n        String uri = request.getRequestURI();\n        if (null == uri || uri.equals(\"\")) {\n            return;\n        }\n        if (uri.indexOf(\"?\") > 0) {\n            uri = uri.substring(0, uri.indexOf(\"?\"));\n        }\n        String cacheKey = uri.concat(sessionId);\n        boolean isClean = request.getParameter(pagCatchClean) == null ? false : true;\n        //空清空缓存\n        if (isClean) {\n            SearainbowCacheManager.del(cacheKey);\n            logger.info(\"清空缓存 key==> \" + cacheKey);\n            return;\n        }\n        //post 查询 存储查询条件\n         if(request.getMethod().toUpperCase().equals(\"POST\") &&  null == request.getParameter(pagRecover)){\n             cache(sessionId, uri, isClean, o);\n         }else {\n             //get 或是其他 还原查询条件\n             recover(sessionId, uri, o);\n         }\n    }\n```\n ","published":1,"updated":"2017-02-13T02:44:28.000Z","_id":"ciyzmpkww0000yt5ruy1vyslx","comments":1,"photos":[],"link":"","content":"<p>用于使用web系统中查询</p>\n<p><a href=\"http://ol5i7ltje.bkt.clouddn.com/data/git/packagecachecom.pagecache.zip\" target=\"_blank\" rel=\"external\">源码下载com.pagecache.zip</a></p>\n<p>基于Spring APO 环绕通知实现</p>\n<p>1.添加配置文件<br>action-servlet.xml 最后添加</p>\n<p><import resource=\"spring-aop-settings.xml\"><br>spring-aop-settings.xml  </import></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div class=\"line\">xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</div><div class=\"line\">xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class=\"line\">        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;&gt;</div><div class=\"line\">&lt;aop:aspectj-autoproxy proxy-target-class=&quot;true&quot; /&gt;</div><div class=\"line\">&lt;/beans&gt;</div></pre></td></tr></table></figure>\n<p>2.修改代码(CacheAspectAdvice.java)<br>第28行 指定切入点控制层</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">@Pointcut(&quot;execution(* com.*.web.*.*(..))&quot;)</div><div class=\"line\"> public void CacheAspectAdvice() &#123;</div><div class=\"line\"> &#125;</div></pre></td></tr></table></figure>\n<p>3.加入注解<br>在自定控制层入口,加入需要记忆和恢复的注解(@FieldCache)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">@RequestMapping(value = &quot;/list.do&quot;)</div><div class=\"line\">public ModelAndView list(HttpServletRequest request,@FieldCache SearchEntity domain)&#123;</div><div class=\"line\">           ModelAndView modelAndView=new ModelAndView();</div><div class=\"line\">           modelAndView.setViewName(&quot;list&quot;);</div><div class=\"line\">           return  modelAndView;</div><div class=\"line\"> &#125;</div></pre></td></tr></table></figure>\n<p>查询数据模型中,默认只会处理 String,Integer 两种类型<br>如果不需要记录属性上方加入 @FieldTransient</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">//这是个栗了</div><div class=\"line\">public class SearchEntity extends BaseInput &#123;</div><div class=\"line\">    @FieldTransient</div><div class=\"line\">    private String searchName;</div><div class=\"line\">    public String get/set...</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>如果其他引用对象里面也要加入记录和恢复(@FieldCache)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">//父类同样回记录,回迭代最终Object</div><div class=\"line\">public class SearchEntity extends BaseInput &#123;</div><div class=\"line\">    @FieldTransient</div><div class=\"line\">    private String searchName;</div><div class=\"line\">    @FieldCache</div><div class=\"line\">    private Page page;</div><div class=\"line\">    public String getSearchName...</div><div class=\"line\">   public String getPage...</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>说明<br>1.从菜单进入需要加参数,会执行清空已经记录查询条件(pagCatchClean) 如:<a href=\"http://xxx/xxx.do?pagCatchClean\" target=\"_blank\" rel=\"external\">http://xxx/xxx.do?pagCatchClean</a></p>\n<p>2.默认情况下 post 的请求记录,get 请求清空,如果post 情况下 也好恢复记录不记录 加参数(pageRecover) 如:<a href=\"http://xxx/xxx.do?pageRecover\" target=\"_blank\" rel=\"external\">http://xxx/xxx.do?pageRecover</a></p>\n<p>3.缓存默认使用的本地,如果需要系统是负载(非hash)模式,需要 实现SearchObjectCache.java接口,存放到共享存储中(redis,mongodb….),<br>SearchObjectCacheManager.java 缓存管理类实现好后 修改 其SearchObjectCache引用即可</p>\n<p>ObjectCache.java 第34行开始</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">  /**</div><div class=\"line\">    * 清空缓存标记</div><div class=\"line\">    * 在浏览器地址加入</div><div class=\"line\">    * http://xxx/xxx.do?pagCatchClean</div><div class=\"line\">    **/</div><div class=\"line\">   public static String pagCatchClean = &quot;pageCacheClean&quot;;</div><div class=\"line\">   public static String pagRecover = &quot;pageRecover&quot;;</div><div class=\"line\">   Logger logger = Logger.getLogger(ObjectCache.class.getName());</div><div class=\"line\">public void cacheManager(HttpServletRequest request, Object o) &#123;</div><div class=\"line\">       String sessionId = request.getSession().getId();</div><div class=\"line\">       String uri = request.getRequestURI();</div><div class=\"line\">       if (null == uri || uri.equals(&quot;&quot;)) &#123;</div><div class=\"line\">           return;</div><div class=\"line\">       &#125;</div><div class=\"line\">       if (uri.indexOf(&quot;?&quot;) &gt; 0) &#123;</div><div class=\"line\">           uri = uri.substring(0, uri.indexOf(&quot;?&quot;));</div><div class=\"line\">       &#125;</div><div class=\"line\">       String cacheKey = uri.concat(sessionId);</div><div class=\"line\">       boolean isClean = request.getParameter(pagCatchClean) == null ? false : true;</div><div class=\"line\">       //空清空缓存</div><div class=\"line\">       if (isClean) &#123;</div><div class=\"line\">           SearainbowCacheManager.del(cacheKey);</div><div class=\"line\">           logger.info(&quot;清空缓存 key==&gt; &quot; + cacheKey);</div><div class=\"line\">           return;</div><div class=\"line\">       &#125;</div><div class=\"line\">       //post 查询 存储查询条件</div><div class=\"line\">        if(request.getMethod().toUpperCase().equals(&quot;POST&quot;) &amp;&amp;  null == request.getParameter(pagRecover))&#123;</div><div class=\"line\">            cache(sessionId, uri, isClean, o);</div><div class=\"line\">        &#125;else &#123;</div><div class=\"line\">            //get 或是其他 还原查询条件</div><div class=\"line\">            recover(sessionId, uri, o);</div><div class=\"line\">        &#125;</div><div class=\"line\">   &#125;</div></pre></td></tr></table></figure>\n","excerpt":"","more":"<p>用于使用web系统中查询</p>\n<p><a href=\"http://ol5i7ltje.bkt.clouddn.com/data/git/packagecachecom.pagecache.zip\">源码下载com.pagecache.zip</a></p>\n<p>基于Spring APO 环绕通知实现</p>\n<p>1.添加配置文件<br>action-servlet.xml 最后添加</p>\n<p><import resource=\"spring-aop-settings.xml\"/><br>spring-aop-settings.xml  </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div class=\"line\">xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</div><div class=\"line\">xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class=\"line\">        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;&gt;</div><div class=\"line\">&lt;aop:aspectj-autoproxy proxy-target-class=&quot;true&quot; /&gt;</div><div class=\"line\">&lt;/beans&gt;</div></pre></td></tr></table></figure>\n<p>2.修改代码(CacheAspectAdvice.java)<br>第28行 指定切入点控制层</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">@Pointcut(&quot;execution(* com.*.web.*.*(..))&quot;)</div><div class=\"line\"> public void CacheAspectAdvice() &#123;</div><div class=\"line\"> &#125;</div></pre></td></tr></table></figure>\n<p>3.加入注解<br>在自定控制层入口,加入需要记忆和恢复的注解(@FieldCache)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">@RequestMapping(value = &quot;/list.do&quot;)</div><div class=\"line\">public ModelAndView list(HttpServletRequest request,@FieldCache SearchEntity domain)&#123;</div><div class=\"line\">           ModelAndView modelAndView=new ModelAndView();</div><div class=\"line\">           modelAndView.setViewName(&quot;list&quot;);</div><div class=\"line\">           return  modelAndView;</div><div class=\"line\"> &#125;</div></pre></td></tr></table></figure>\n<p>查询数据模型中,默认只会处理 String,Integer 两种类型<br>如果不需要记录属性上方加入 @FieldTransient</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">//这是个栗了</div><div class=\"line\">public class SearchEntity extends BaseInput &#123;</div><div class=\"line\">    @FieldTransient</div><div class=\"line\">    private String searchName;</div><div class=\"line\">    public String get/set...</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>如果其他引用对象里面也要加入记录和恢复(@FieldCache)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">//父类同样回记录,回迭代最终Object</div><div class=\"line\">public class SearchEntity extends BaseInput &#123;</div><div class=\"line\">    @FieldTransient</div><div class=\"line\">    private String searchName;</div><div class=\"line\">    @FieldCache</div><div class=\"line\">    private Page page;</div><div class=\"line\">    public String getSearchName...</div><div class=\"line\">   public String getPage...</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>说明<br>1.从菜单进入需要加参数,会执行清空已经记录查询条件(pagCatchClean) 如:<a href=\"http://xxx/xxx.do?pagCatchClean\">http://xxx/xxx.do?pagCatchClean</a></p>\n<p>2.默认情况下 post 的请求记录,get 请求清空,如果post 情况下 也好恢复记录不记录 加参数(pageRecover) 如:<a href=\"http://xxx/xxx.do?pageRecover\">http://xxx/xxx.do?pageRecover</a></p>\n<p>3.缓存默认使用的本地,如果需要系统是负载(非hash)模式,需要 实现SearchObjectCache.java接口,存放到共享存储中(redis,mongodb….),<br>SearchObjectCacheManager.java 缓存管理类实现好后 修改 其SearchObjectCache引用即可</p>\n<p>ObjectCache.java 第34行开始</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">  /**</div><div class=\"line\">    * 清空缓存标记</div><div class=\"line\">    * 在浏览器地址加入</div><div class=\"line\">    * http://xxx/xxx.do?pagCatchClean</div><div class=\"line\">    **/</div><div class=\"line\">   public static String pagCatchClean = &quot;pageCacheClean&quot;;</div><div class=\"line\">   public static String pagRecover = &quot;pageRecover&quot;;</div><div class=\"line\">   Logger logger = Logger.getLogger(ObjectCache.class.getName());</div><div class=\"line\">public void cacheManager(HttpServletRequest request, Object o) &#123;</div><div class=\"line\">       String sessionId = request.getSession().getId();</div><div class=\"line\">       String uri = request.getRequestURI();</div><div class=\"line\">       if (null == uri || uri.equals(&quot;&quot;)) &#123;</div><div class=\"line\">           return;</div><div class=\"line\">       &#125;</div><div class=\"line\">       if (uri.indexOf(&quot;?&quot;) &gt; 0) &#123;</div><div class=\"line\">           uri = uri.substring(0, uri.indexOf(&quot;?&quot;));</div><div class=\"line\">       &#125;</div><div class=\"line\">       String cacheKey = uri.concat(sessionId);</div><div class=\"line\">       boolean isClean = request.getParameter(pagCatchClean) == null ? false : true;</div><div class=\"line\">       //空清空缓存</div><div class=\"line\">       if (isClean) &#123;</div><div class=\"line\">           SearainbowCacheManager.del(cacheKey);</div><div class=\"line\">           logger.info(&quot;清空缓存 key==&gt; &quot; + cacheKey);</div><div class=\"line\">           return;</div><div class=\"line\">       &#125;</div><div class=\"line\">       //post 查询 存储查询条件</div><div class=\"line\">        if(request.getMethod().toUpperCase().equals(&quot;POST&quot;) &amp;&amp;  null == request.getParameter(pagRecover))&#123;</div><div class=\"line\">            cache(sessionId, uri, isClean, o);</div><div class=\"line\">        &#125;else &#123;</div><div class=\"line\">            //get 或是其他 还原查询条件</div><div class=\"line\">            recover(sessionId, uri, o);</div><div class=\"line\">        &#125;</div><div class=\"line\">   &#125;</div></pre></td></tr></table></figure>\n"}],"PostAsset":[],"PostCategory":[],"PostTag":[{"post_id":"ciyzmpkww0000yt5ruy1vyslx","tag_id":"ciyzmpkx10001yt5rfz3j68os","_id":"ciyzmpkx40002yt5rf6pijqyl"}],"Tag":[{"name":"java","_id":"ciyzmpkx10001yt5rfz3j68os"}]}}